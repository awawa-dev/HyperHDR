# Define the current source locations
SET(CURRENT_HEADER_DIR ${CMAKE_SOURCE_DIR}/include/db)
SET(CURRENT_SOURCE_DIR ${CMAKE_SOURCE_DIR}/sources/db)

FILE ( GLOB DB_SOURCES "${CURRENT_HEADER_DIR}/*.h"  "${CURRENT_SOURCE_DIR}/*.h"  "${CURRENT_SOURCE_DIR}/*.cpp" )

add_library(database
	${DB_SOURCES}
)

target_link_libraries(database
	hyperhdr-base
	hyperhdr-utils
	Qt${Qt_VERSION}::Core
	Qt${Qt_VERSION}::Sql
)

if (USE_STATIC_QT_PLUGINS)
	target_link_libraries(database ${STATIC_QT_PLUGINS_LIBS})
endif()

if(USE_PRECOMPILED_HEADERS AND COMMAND target_precompile_headers)
    target_precompile_headers(database REUSE_FROM precompiled_hyperhdr_headers)
endif()

add_library(sqlite3 "${CURRENT_SOURCE_DIR}/sqlite/sqlite3.c")
target_include_directories(sqlite3 PUBLIC "${CURRENT_SOURCE_DIR}/sqlite")
target_link_libraries(sqlite3 PUBLIC ${CMAKE_THREAD_LIBS_INIT} ${CMAKE_DL_LIBS})
target_link_libraries(database sqlite3)

set_target_properties(sqlite3 PROPERTIES
    OUTPUT_NAME   sqlite3
    PUBLIC_HEADER sqlite3.h
)

target_compile_definitions(sqlite3 PUBLIC
	SQLITE_THREADSAFE=2
	SQLITE_DEFAULT_MEMSTATUS=0
	SQLITE_DEFAULT_SYNCHRONOUS=3	
	SQLITE_OMIT_AUTHORIZATION
	SQLITE_OMIT_AUTOINCREMENT
	SQLITE_OMIT_AUTOMATIC_INDEX
	SQLITE_OMIT_INCRBLOB
	SQLITE_OMIT_AUTORESET
	SQLITE_OMIT_AUTOVACUUM
	SQLITE_OMIT_BETWEEN_OPTIMIZATION
	SQLITE_OMIT_BLOB_LITERAL
	SQLITE_OMIT_BTREECOUNT
	SQLITE_OMIT_CHECK
	SQLITE_OMIT_COMPILEOPTION_DIAGS
	SQLITE_OMIT_COMPLETE
	SQLITE_OMIT_DEPRECATED
	SQLITE_OMIT_FLAG_PRAGMAS
	SQLITE_OMIT_EXPLAIN
	SQLITE_OMIT_FOREIGN_KEY
	SQLITE_OMIT_GET_TABLE
	SQLITE_OMIT_LIKE_OPTIMIZATION
	SQLITE_OMIT_LOAD_EXTENSION
	SQLITE_OMIT_OR_OPTIMIZATION
	SQLITE_OMIT_PROGRESS_CALLBACK
	SQLITE_OMIT_QUICKBALANCE
	SQLITE_OMIT_SCHEMA_PRAGMAS
	SQLITE_OMIT_SCHEMA_VERSION_PRAGMAS
	SQLITE_OMIT_TCL_VARIABLE
	SQLITE_OMIT_TEMPDB
	SQLITE_OMIT_TRACE
	SQLITE_OMIT_TRUNCATE_OPTIMIZATION 
	SQLITE_OMIT_WAL
	SQLITE_OMIT_XFER_OPT)
